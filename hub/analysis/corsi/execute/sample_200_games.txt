
gcloud dataproc clusters create delta-cluster1 --initialization-actions gs://nhl-seasons/install_requirements.sh --region=us-east1 --num-workers 2 --worker-boot-disk-size 30GB --master-boot-disk-size 30GB --properties "spark:spark.driver.memory=2g,spark:spark.executor.memory=2g"

gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/ingest_nhl_play_html.py -- --gamemin 2021020001 --gamemax 2021020100 --output_bucket nhl-21-22 --output_destination output --write_mode overwrite
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/ingest_nhl_play_html.py -- --gamemin 2021020100 --gamemax 2021020200 --output_bucket nhl-21-22 --output_destination output --write_mode append
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/html_to_sparse_parquet.py -- --output_bucket nhl-21-22 --output_destination output

gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/prepare_corsi_input_data.py -- --input_bucket_name nhl-21-22 --input_fs_plays output/plays_sparse_detail --input_fs_forwards output/raw_forwards --input_fs_defense output/raw_defense --output_bucket_name nhl-21-22 --output_fs_plays corsi/input_parquet/partitioned_plays --output_fs_forwards corsi/input_parquet/partitioned_forwards --output_fs_defense corsi/input_parquet/partitioned_defense --hm_count 50

gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team ANA --write_mode overwrite 
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team ARI --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team CHI --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team CGY --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team COL --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team EDM --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team DAL --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team LAK --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team MIN --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team SJS --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team SEA --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team NSH --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team STL --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team VAN --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team VGK --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team WPG --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team BOS --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team BUF --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team DET --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team FLA --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team MTL --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team OTT --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team TBL --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team TOR --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team CAR --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team CBJ --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team NJD --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team NYI --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team NYR --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team PHI --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team PIT --write_mode append   
gcloud dataproc jobs submit pyspark --cluster=delta-cluster1 --region=us-east1 -- gs://nhl-seasons/job/dataproc_corsi_from_nhl_plays.py -- --bucket_name nhl-21-22 --fs_plays corsi/input_parquet/partitioned_plays --fs_forwards corsi/input_parquet/partitioned_forwards --fs_defense corsi/input_parquet/partitioned_defense --output_location corsi/full_season  --single_team WSH --write_mode append   

bq load - -location="us-east1" --source_format=PARQUET nhl_2021_2022_season.corsi_team_player_game_detail "gs://nhl-seasons/corsi/full_season/team_player_game_detail/*.parquet"
bq load - -location="us-east1" --source_format=PARQUET nhl_2021_2022_season.corsi_team_player_summary "gs://nhl-seasons/corsi/full_season/team_player_summary/*.parquet"

bq load - -location="us-east1" --source_format=PARQUET use_nhl.corsi_team_player_summary_21_22 "nhl-seasons/corsi/full_season/team_player_game_detail/*.parquet"


